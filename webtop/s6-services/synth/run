#!/command/with-contenv bash
set -e

# Ensure synth config directory exists and is writable
mkdir -p /config/.config/
sudo chmod a+rwx -R /config

echo "[S6 synth] Attendo /tmp/.X11-unix/X1..."
while [ ! -e /tmp/.X11-unix/X1 ]; do
    sleep 2
    echo "[S6 synth] Still waiting for /tmp/.X11-unix/X1..."
done

echo "[S6 synth] Avvio Synthetic Heart..."
cd /app
exec /app/synth.sh run
