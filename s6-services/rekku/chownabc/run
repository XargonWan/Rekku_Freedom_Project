#!/command/with-contenv bash
set -e

ABC_USER=abc
ABC_UID=$(id -u "$ABC_USER")
ABC_GID=$(id -g "$ABC_USER")

# Pre-create configuration directories to block other services from creating them with wrong ownership
mkdir -p /config/.config /config/.config/chromium-rfp || true

# First pass: ensure /config is owned by abc and has user and group rwx permissions
chown -R "$ABC_UID:$ABC_GID" /config || true
chmod -R ug+rwX /config || true

# Second pass after a short delay to correct any late creations (e.g., from background services)
sleep 2
chown -R "$ABC_UID:$ABC_GID" /config || true

echo "[S6 Rekku] Ownership and permissions of /config set to abc."
